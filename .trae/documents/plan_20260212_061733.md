# 实现 Cloudflare D1 + Pages Functions 共享邀请码功能

## 核心目标
将目前的纯静态本地存储 (`localStorage`) 改造为基于 Cloudflare D1 数据库的动态共享平台，实现多用户之间的数据同步。

## 步骤 1：本地环境准备 (Backend Setup)
1.  **安装 Wrangler CLI**：Cloudflare 的命令行工具，用于本地开发和部署。
2.  **初始化 D1 数据库**：
    *   在 `wrangler.toml` 中配置数据库绑定。
    *   创建 SQL 初始化脚本 (schema)，定义表结构（id, code, status, note, addedBy, createdAt）。
    *   执行本地数据库迁移。

## 步骤 2：创建后端 API (Pages Functions)
在项目根目录下创建 `functions/api` 目录，编写以下接口：
1.  **GET `/api/codes`**：获取所有邀请码列表。
2.  **POST `/api/codes`**：用户提交新的邀请码。
3.  **PATCH `/api/codes/:id`**：更新邀请码状态（如：锁定、已领取）。
4.  **DELETE `/api/codes/:id`**：删除邀请码。

## 步骤 3：前端改造 (Frontend Integration)
修改 `App.tsx` 和相关组件：
1.  **移除 `localStorage`**：删除所有本地存储相关的代码。
2.  **接入 API**：
    *   页面加载时调用 `fetch('/api/codes')` 获取数据。
    *   提交表单时调用 `POST` 接口。
    *   点击复制/领取时调用 `PATCH` 接口。

## 步骤 4：本地调试与部署 (Deploy)
1.  **本地联调**：使用 `wrangler pages dev` 启动本地服务，模拟真实环境。
2.  **部署上线**：
    *   在 Cloudflare 后台创建 D1 数据库。
    *   将本地数据库结构同步到线上。
    *   重新部署 Pages 项目。

---

**确认执行？**
我将首先从 **步骤 1：本地环境准备** 开始，安装必要的依赖并创建数据库配置文件。
